name: CI/CD Pipeline
     on:
       push:
         branches: [ main, develop ]
       pull_request:
         branches: [ main ]
     env:
       NODE_ENV: test
       MONGODB_URL: mongodb://localhost:27017/node-boilerplate-test
     jobs:
       test:
         runs-on: ubuntu-latest
         services:
           mongodb:
             image: mongo:4.4
             ports:
               - 27017:27017
         steps:
           - uses: actions/checkout@v3
           - name: Set up Node.js
             uses: actions/setup-node@v3
             with:
               node-version: '18'
               cache: 'npm'
           - name: Install dependencies
             run: npm ci
           - name: Run ESLint
             run: npm run lint
           - name: Run tests
             run: npm run test:coverage
           - name: Upload coverage to Codecov
             uses: codecov/codecov-action@v3
             with:
               token: ${{ secrets.CODECOV_TOKEN }}
               file: ./coverage/lcov.info
       deploy-staging:
         needs: test
         if: github.event_name == 'push' && github.ref == 'refs/heads/develop'
         runs-on: ubuntu-latest
         steps:
           - uses: actions/checkout@v3
           - name: Deploy to Heroku (Staging)
             uses: akhileshns/heroku-deploy@v3.12.12
             with:
               heroku_api_key: ${{ secrets.HEROKU_API_KEY }}
               heroku_app_name: mi-app-staging
               heroku_email: ${{ secrets.HEROKU_EMAIL }}
               usedocker: false
       deploy-production:
         needs: test
         if: github.event_name == 'push' && github.ref == 'refs/heads/main'
         runs-on: ubuntu-latest
         steps:
           - uses: actions/checkout@v3
           - name: Deploy to Heroku (Production)
             uses: akhileshns/heroku-deploy@v3.12.12
             with:
               heroku_api_key: ${{ secrets.HEROKU_API_KEY }}
               heroku_app_name: mi-app-production
               heroku_email: ${{ secrets.HEROKU_EMAIL }}
               usedocker: false